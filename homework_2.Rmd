---
title: "Homework 1"
author: "Mingyin Wang"
date: 2024-09-28
output: github_document
---

```{r, echo = FALSE}
library(tidyverse)
library(readxl)
library(haven)
```

## Problem 2
load and clean mr trash wheel dataset
```{r}
mr_trash_wheel = read_excel("data/202409 Trash Wheel Collection Data.xlsx", sheet = "Mr. Trash Wheel", skip = 1) |>
  janitor::clean_names() |>
  filter(!is.na(dumpster)) |>
  mutate(
    sports_balls = as.integer(round(sports_balls)), 
    source = "Mr. Trash Wheel"
  )
mr_trash_wheel
```

load and clean prof trash wheel dataset
```{r}
prof_trash_wheel = read_excel("data/202409 Trash Wheel Collection Data.xlsx", sheet = "Professor Trash Wheel", skip = 1) |>
  janitor::clean_names() |>
  filter(!is.na(dumpster)) |>
  mutate(
   year = as.character(year), 
    source = "Professor Trash Wheel"
  )
prof_trash_wheel
```


load and clean Gwynnda trash wheel dataset

```{r}
gwynnda_trash_wheel = read_excel("data/202409 Trash Wheel Collection Data.xlsx", sheet = "Gwynnda Trash Wheel", skip = 1) |>
  janitor::clean_names() |>
  filter(!is.na(dumpster)) |>
  mutate(
   year = as.character(year), 
    source = "Gwynnda Trash Wheel"
  )
gwynnda_trash_wheel
```

combine three dataset
```{r}
trash_wheel_data = 
  bind_rows(mr_trash_wheel, prof_trash_wheel, gwynnda_trash_wheel) |> 
  relocate(source)
trash_wheel_data
```

total weight collected by prof trash wheel

```{r}
total_weight_pro = 
  trash_wheel_data |>
  filter(source == "Professor Trash Wheel") |> 
  summarize(total_weight = sum(weight_tons, na.rm = TRUE))
total_weight_pro
```
The total weight collected by prof trash wheel is `r total_weight_pro` tons.

Total cigarette butts collected by Gwynnda in June 2022
```{r}
tot_butts_june_2022=
   trash_wheel_data |> 
    filter(source == "Gwynnda Trash Wheel", month =="June", year == "2022") |> 
  summarize(total_weight = sum(weight_tons, na.rm = TRUE))

tot_butts_june_2022
```
The total cigarette butts collected by Gwynnda in June 2022 is `r tot_butts_june_2022` tons. 

## Problem 3
load the dataset and did some cleaning

```{r}
bakers_df = read_csv("./data/bakers.csv", na = c("NA", ".", "", "N/A")) |> 
  janitor::clean_names() |>
  mutate(
    series = as.numeric(series), 
    baker_name = str_to_lower(str_trim(baker_name)), 
     baker =  word(baker_name, 1)
  )


bakes_df = read_csv("./data/bakes.csv", na = c("NA", ".", "", "N/A")) |> 
  janitor::clean_names() |>
  mutate(
    series = as.numeric(series),
    episode = as.numeric(episode), 
    baker = str_to_lower(str_trim(baker)),  
    baker = ifelse(baker == '"jo"', "joanne", baker)  
  )


results_df = read_csv("./data/results.csv", na = c("NA", ".", "", "N/A"), skip = 2) |> 
  janitor::clean_names() |>
  mutate(
    series = as.numeric(series),
    episode = as.numeric(episode), 
    baker = str_to_lower(str_trim(baker))  
  )
```

use `anti_join()` to compare three datasets


```{r}
anti_join(bakes_df, results_df, by = c("series", "episode", "baker"))
anti_join(results_df, bakes_df, by = c("series", "episode", "baker"))
anti_join(bakers_df, bakes_df, by = c("baker", "series"))
anti_join(bakes_df, bakers_df, by = c("baker", "series"))
anti_join(results_df, bakers_df, by = c("series", "baker"))
anti_join(bakers_df, results_df, by = c("series","baker"))
```
I found out that Jo is actually Joanne, then I change it. 


merge all three
```{r}
final_df = results_df |>
  left_join(bakes_df, by = c("series", "episode", "baker")) |>
  left_join(bakers_df, by = c("series", "baker")) 
```





star bakers and winners from series 5 to 10
```{r}
star_bakers = final_df |> 
  filter(series >= 5 & series <= 10) |> 
  filter(result == "STAR BAKER" | result == "WINNER") |> 
  select(series, episode, baker, result)

star_bakers
```

From series 5 to 10, the all the winners are from episode 10. 

load and clean the viewership data 

```{r}
viewers_df = read_csv("./data/viewers.csv", na = c("NA", ".", "", "N/A")) |> 
  janitor::clean_names()

tidy_viewers_df = viewers_df |> 
  pivot_longer(
    cols = starts_with("series"),  # Pivot columns that start with "series"
    names_to = "season",  # The new column for the season (extracted from the column names)
    values_to = "viewers",  # The corresponding viewership value for each season
     names_prefix = "series_" # Remove the "series_" prefix to extract only the season number
  ) |> 
  mutate(
    season = as.numeric(season)  # Convert the season values to numeric
  )

head(tidy_viewers_df, 10)
```
the avg viewers in series 1

```{r}

avg_viewers_season_1 <- tidy_viewers_df |> 
  filter(season == 1) |>  
  summarise(avg_viewers = mean(viewers, na.rm = TRUE))
  avg_viewers_season_1
```

```{r}

avg_viewers_season_5 <- tidy_viewers_df |> 
  filter(season == 5) |>  
  summarise(avg_viewers = mean(viewers, na.rm = TRUE))
  avg_viewers_season_5
  
```
